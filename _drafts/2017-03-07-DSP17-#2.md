---
layout: post
title:  "DSP-17 #2: Build a rocket, fly to kernelspace - the simple
Linux Kernel Development setup"
author: Stan Drozd
date:   2017-03-08 8:00:00 +0100
categories: dsp17
excerpt: Penguin hatchery HOWTO a.k.a. The Revival of Picotux
tags: dsp17 kernel busybox linux qemu basic tutorial environment vm development
---
In my [previous post]({% post_url 2017-03-02-DSP17-1-the-kernel-role-in-OS %}),
I mentioned that some errors in the kernel usually mean reboots. You can
certainly agree that whenever one learns a new technology, mistakes are
inevitable, and rebooting after every error we cause could become a bit
time-consuming. Needless to say, crashing the live kernel on a machine with
unsaved work can be **very** disheartening - it can also lead to more serious
filesystem corruptions.

# The plan
To avoid that, we're going to build ourselves a bare bones virtual machine
using an emulator called [QEMU][qemu]. This VM will then boot the kernel and
give us a simple shell with a bunch of tools. Using a virtual machine also
stands together with easy debugging and fine-grained control over the system's
virtual hardware.

# My earlier attempts
Before starting this blog, I tried to build [something similar][picotux], but it
didn't turn out that great. Let's make things right this time, shall we?

Here's what we're gonna use:
* **QEMU** - Most Linux distributions and [macOS][qemu-mac] should have you covered,
  Windows has it a bit harder, but you can use unofficial precompiled
  [binaries][qemu-windows-binaries], or run a different VM hypervisor for the
  development environment (kernel module builds shouldn't get too resource heavy
  after building the kernel)
* **Basic grasp on GNU Makefiles** - 
* **Practical git and Linux shell knowledge**

# Getting sources

* Short note on git's original purpose
* The layout we're gonna use
```shell
$ git submodule add https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git
$ git submodule add https://github.com/mirror/busybox.git
```

# Writing the Makefile
* Automatic build invocation

# Configuring the sources

# Compiling
* Invoking make

# Lift-off! :rocket:
* Add a QEMU invocation to the Makefile
* Run QEMU

# "Uh-oh!" a.k.a. setting up a simple filesystem image
* Why the kernel panicked
* initramfs description

# It's alive!
![image](https://media.tenor.co/images/062b0072b9006b2b0578054a0850860b/raw)

# Known problems
* The kvm group

# Okay, what now?
* Announce the next post

# Further reading
* [Kernel Newbies](https://kernelnewbies.org/) - A really nice page for
  beginners
* [Linux Weekly News](https://lwn.net/) - The renowned authority for news on
  Linux

[cygwin]:https://www.cygwin.com/
[picotux]:https://www.github.com/drozdziak1/picotux/
[qemu-compile]:https://en.wikibooks.org/wiki/QEMU/Cygwin
[qemu-mac]:http://brewformulas.org/Qemu
[qemu-windows-binaries]:http://wiki.qemu-project.org/Links#Unofficial_QEMU_binaries
[qemu]:www.qemu-project.org/
